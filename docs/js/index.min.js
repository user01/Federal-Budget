var Utility;!function(a){var b=function(){function a(){var a=this;this.callbacks={},this.on=function(b,c){"string"==typeof b&&(a.ensureExists(b),a.callbacks[b].push(c))},this.off=function(b,c){if("string"==typeof b&&a.callbacks[b])for(var d=0;d<a.callbacks[b].length;d++)if(a.callbacks[b][d]===c)return void delete a.callbacks[b][d]},this.runCallback=function(b,c){if(void 0===c&&(c=null),"string"==typeof b&&a.callbacks[b])for(var d=0;d<a.callbacks[b].length;d++)a.callbacks[b][d](c)},this.ensureExists=function(b){a.callbacks[b]||(a.callbacks[b]=new Array)}}return a}();a.CbBase=b}(Utility||(Utility={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Graph;!function(a){var b=function(a){function b(c,d,e){var f=this;void 0===d&&(d=1960),void 0===e&&(e=2013),a.call(this),this.id=c,this.yearStart=d,this.yearEnd=e,this.width=0,this.height=0,this.marginPx=8,this.targetYear=0,this.currentYear=0,this.handleClick=function(a){var b=f.xScale.invert(a),c=b.getFullYear();f.targetYear=c,f.targetYear=Math.max(Math.min(f.targetYear,f.yearEnd-1),f.yearStart+1),f.handleNewYear(),f.runCallback("newTarget",f.targetYear)},this.resize=function(){f.collectHeightWidth(),f.xScale.range([0,f.width]).nice(),f.graphSvg.attr("width",f.width+2*f.marginPx).attr("height",f.height+2*f.marginPx),f.handleNewYear(-1,0,0)},this.collectHeightWidth=function(){f.width=parseInt(f.d3GraphElement.style("width"))-2*f.marginPx,f.height=parseInt(f.d3GraphElement.style("height"))-2*f.marginPx},this.handleNewYear=function(a,c,d){void 0===a&&(a=-1),void 0===c&&(c=-1),void 0===d&&(d=1),f.currentYear=a>0?a:f.currentYear;var e=250*d;f.xScale.domain([b.parseYear(f.yearStart+""),b.parseYear(f.yearEnd+"")]);var g=Math.max(Math.floor((f.width-20)/150),1),h=d3.svg.axis().scale(f.xScale).orient("bottom").tickPadding(4).ticks(g);f.graphSvg.selectAll(".x.axis")[0].length<1?f.graphSvg.append("g").attr("class","x axis").attr("transform","translate(0,0)").call(h).selectAll("text").style("text-anchor","start"):f.graphSvg.selectAll(".x.axis").transition().duration(e).attr("transform","translate(0,0)").call(h).selectAll("text").style("text-anchor","start"),f.areaRange.y0(f.height);var i=f.graphSvg.transition().duration(e),j="06-15-"+(f.targetYear-1),k="06-15-"+f.targetYear,l="10-15-"+(f.currentYear-1),m="02-15-"+f.currentYear;i.select(".area.alive").attr("d",f.areaRange([j,k])),i.select(".area.current").attr("d",f.areaRange([l,m]))},this.newCurrentYear=function(a,b){void 0===a&&(a=-1),void 0===b&&(b=1),a>0&&(f.currentYear=a);var c=150*b,d="10-15-"+(f.currentYear-1),e="02-15-"+f.currentYear;f.graphSvg.select(".area.current").transition().duration(c).attr("d",f.areaRange([d,e]))},this.d3GraphElement=d3.select("#"+this.id),this.collectHeightWidth(),this.targetYear=this.yearEnd,this.currentYear=this.targetYear,this.xScale=d3.time.scale().range([0,this.width]).nice(),this.yScale=d3.scale.linear().range([this.height,0]).domain([0,1]).nice(),this.areaRange=this.generateArea(),this.areaCurrent=this.generateArea(),this.graphSvg=this.d3GraphElement.attr("width",this.width+2*this.marginPx).attr("height",this.height+2*this.marginPx).append("g").attr("transform","translate("+this.marginPx+","+this.marginPx+")"),this.graphSvg.append("path").attr("class","area alive"),this.graphSvg.append("path").attr("class","area current"),d3.select(window).on("resize."+this.id,this.resize),this.resize();var g=this.handleClick;this.d3GraphElement.on("click",function(){var a=d3.mouse(this),b=a[0];g(b)})}return __extends(b,a),b.prototype.generateArea=function(){var a=this;return d3.svg.area().x(function(c){return a.xScale(b.parseDate(c+""))}).y0(this.height).y1(function(a){return.75})},b.prototype.SetRange=function(a,b){this.yearStart=a,this.yearEnd=b,this.handleNewYear()},b.parseDate=d3.time.format("%m-%d-%Y").parse,b.parseYear=d3.time.format("%Y").parse,b}(Utility.CbBase);a.YearHead=b}(Graph||(Graph={}));var Utility;!function(a){var b=function(a){function b(c){var d=this;a.call(this),this.path=c,this._ready=!1,this._yearStart=0,this._yearEnd=0,this._factor=1,this._dataSet=[],this.Initialize=function(){return d.timestamp&&d._data&&Date.now()-d.timestamp<b.staleSeconds?void d.createPatchedData():void d3.json(d.path,function(a,b){a?d.renderError():(d.timestamp=Date.now(),d._data=b,d.createPatchedData())})},this.createPatchedData=function(){var a=d._data;d._yearStart=a.yearStart,d._yearEnd=a.yearEnd,d._factor=R.is(Number,a.factor)?a.factor:1,d._dataSet=R.map(R.multiply(d._factor),a.data),d._ready=!0,d.runCallback("data",d)},this.CullData=function(a,b){if(a>d._yearStart&&d._dataSet.splice(0,a-d._yearStart),b<d._yearEnd){var c=b-a+1,e=d._yearEnd-b;d._dataSet.splice(c,e)}return d._yearStart=a,d._yearEnd=b,d},this.renderError=function(){}}return __extends(b,a),Object.defineProperty(b.prototype,"Ready",{get:function(){return this._ready},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"YearStart",{get:function(){return this._yearStart},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"YearEnd",{get:function(){return this._yearEnd},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Factor",{get:function(){return this._factor},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"DataSet",{get:function(){return this._dataSet},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"pullTimestampId",{get:function(){return b.prefix+this.path+"_Pull"},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"pullDataId",{get:function(){return b.prefix+this.path+"_Data"},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"_data",{get:function(){return JSON.parse(localStorage[this.pullDataId])},set:function(a){localStorage[this.pullDataId]=JSON.stringify(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"timestamp",{get:function(){return+localStorage[this.pullTimestampId]},set:function(a){localStorage[this.pullTimestampId]=a},enumerable:!0,configurable:!0}),b.staleSeconds=259200,b.prefix="DataSet_",b}(a.CbBase);a.DataSet=b}(Utility||(Utility={}));var Utility;!function(a){var b=function(a){function b(){var b=this;a.apply(this,arguments),this.createPatchedData=function(){var a=b._data;b._yearStart=a.yearStart,b._yearEnd=a.yearEnd,b._factor=R.is(Number,a.factor)?a.factor:1;var c=function(a){return R.isArrayLike(a)?R.map(R.multiply(b._factor))(a):a};b._dataSet=R.map(R.mapObj(c))(a.data),b._ready=!0,b.runCallback("data",b)},this.CullData=function(a,c){var d=Math.max(0,a-b._yearEnd),e=c-a+1,f=Math.max(0,b._yearEnd-c),g=function(a){return R.isArrayLike(a)?(a.splice(0,d),a.splice(e,f),a):a},h=function(a){return R.mapObj(g)(a)};return b._dataSet=R.map(h)(b._dataSet),b._yearStart=a,b._yearEnd=c,b}}return __extends(b,a),b}(a.DataSet);a.DataRich=b}(Utility||(Utility={}));var Utility;!function(a){var b=function(b){function c(d){var e=this;void 0===d&&(d=""),b.call(this),this.rootPath=d,this.Initialize=function(){e.Sets={gdp:new a.DataSet(e.rootPath+"/gdp.json"),cpi:new a.DataSet(e.rootPath+"/cpi.json"),population:new a.DataSet(e.rootPath+"/population.json"),budget:new a.DataRich(e.rootPath+"/budget.json")},R.values(e.Sets).forEach(function(a){a.on("data",e.dataLoaded),a.Initialize()})},this.dataLoaded=function(){if(c.allReadySets(R.values(e.Sets))){e._yearStart=R.pipe(R.values,R.map(R.prop("YearStart")),R.max)(e.Sets),e._yearEnd=R.pipe(R.values,R.map(R.prop("YearEnd")),R.min)(e.Sets);R.mapObj(function(a){return a.CullData(e._yearStart,e._yearEnd)})(e.Sets);e.runCallback("data",e)}}}return __extends(c,b),Object.defineProperty(c.prototype,"YearStart",{get:function(){return this._yearStart},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"YearEnd",{get:function(){return this._yearEnd},enumerable:!0,configurable:!0}),c.allReadySets=R.all(function(a){return a.Ready}),c}(a.CbBase);a.DataAll=b}(Utility||(Utility={}));var Graph;!function(a){!function(a){a[a.Raw=0]="Raw",a[a.GDP=1]="GDP",a[a.Capita=2]="Capita",a[a.Real=3]="Real",a[a.RealCapita=4]="RealCapita"}(a.SpendingMode||(a.SpendingMode={}));var b=a.SpendingMode,c=function(a){function c(d,e){var f=this;a.call(this),this.id=d,this.data=e,this.width=0,this.height=0,this._year=0,this._yearDesired=0,this._mode=b.Raw,this._valueMaxRaw=0,this._valueMaxGdp=0,this._valueMaxCapita=0,this._valueMaxReal=0,this._valueMaxRealCapita=0,this._superfunctions=c.pluckUniqueSuperFunctions(this.data.Sets.budget.DataSet),this._functions=c.pluckUniqueFunctions(this.data.Sets.budget.DataSet),this.resize=function(){f.collectHeightWidth(),f.backdrop.attr("width",f.width).attr("height",f.height),f.force.size([.9*f.width,f.height]),f.resetRanges(),f.elevationScale.range([.7*f.height,.5*f.height,.3*f.height]),f.data.Sets.budget.DataSet=R.mapIndexed(f.setCyForObj)(f.data.Sets.budget.DataSet),f.RenderNewState(0)},this.RenderNewState=function(a){void 0===a&&(a=1),f.YearDesired>f.Year?f.Year++:f.YearDesired<f.Year&&f.Year--;f.d3GraphElement.selectAll(".dot").data(f.data.Sets.budget.DataSet,c.key).transition().ease("linear").duration(150*a).style("stroke",function(a){return f.color(f.deltaPercent(a))}).attr("r",function(a){return Math.max(0,f.radius(a)-1)}).call(c.endall,function(){f.runCallback("renderedYear",f.Year),f.YearDesired!=f.Year&&f.RenderNewState()});f.force.start(),f._tooltipData&&f.tooltipUpdate();f.d3GraphElement.selectAll(".legend").data(f.superFunctionColor.domain().slice()).transition().ease("linear").duration(150*a).attr("transform",f.legendTransform),f.d3GraphElement.selectAll(".blocks").transition().ease("linear").duration(150*a).attr("x",f.width-f.legendWidth()).attr("width",f.legendWidth()).attr("height",f.blockHeight).style("fill",f.superFunctionColor),f.d3GraphElement.selectAll(".blocks-text").transition().ease("linear").duration(150*a).attr("y",f.legendTextY).text(f.legendText).attr("x",f.width-f.legendWidth()-6)},this.collectHeightWidth=function(){f.width=parseInt(f.d3GraphElement.style("width")),f.height=parseInt(f.d3GraphElement.style("height"));var a=Math.min(f.width,f.height);Math.PI*Math.pow(a/2,2)},this.legendTransform=function(a,b){var c=f.superIndexFractionStart(b),d=f.superFunctionsScale(c);return"translate(0,"+d+")"},this.blockHeight=function(a,b){var c=f.superFunctionsScale(f.superIndexFractionSize(b))+1;return c},this.legendText=function(a,b){var c=f.superIndexFractionSize(b);return f._superfunctions[a]&&c>.05?f._superfunctions[a]+" "+Math.floor(100*c)+"%":""},this.legendTextY=function(a,b){return f.superFunctionsScale(f.superIndexFractionSize(b))/2},this.radius=function(a){var d,e=f.value(a);switch(f._mode){case b.Raw:d=f.radiusRawScale(e);break;case b.GDP:d=f.radiusGdpScale(e);break;case b.Capita:d=f.radiusCapitaScale(e);break;case b.Real:d=f.radiusRealScale(e);break;case b.RealCapita:d=f.radiusRealCapitaScale(e)}return a.radius=c.areaToRadius(Math.max(0,d)),a.radius},this.deltaPercent=function(a){if(f.Year<=f.data.YearStart)return 0;var b=f.value(a,f.Year),c=f.value(a,f.Year-1);return(b-c)/c*100},this.value=function(a,c){void 0===c&&(c=f.Year);var d=f.yearToIndex(c),e=a.data[d];switch(f._mode){case b.Raw:break;case b.GDP:e/=f.data.Sets.gdp.DataSet[d];break;case b.Capita:e/=f.data.Sets.population.DataSet[d];break;case b.Real:e/=f.data.Sets.cpi.DataSet[d];break;case b.RealCapita:e=e/f.data.Sets.cpi.DataSet[d]/f.data.Sets.population.DataSet[d]}return Math.max(1e-5,e)},this.yearToIndex=function(a){return Math.max(0,Math.floor(a)-f.data.Sets.budget.YearStart)},this.maxvalueGDPCompute=function(){var a=R.range(f.data.Sets.budget.YearStart,f.data.Sets.budget.YearEnd+1),b=R.pluck("data")(f.data.Sets.budget.DataSet),c=R.pipe(f.yearToIndex,R.nth),d=R.map(function(a){var d=f.yearToIndex(a),e=c(a),g=R.map(e)(b),h=R.sum(g),i=f.data.Sets.gdp.DataSet[d];return h/i})(a);return f._valueMaxGdp=R.max(d),f._valueMaxGdp},this.maxvalueCapitaCompute=function(){var a=R.range(f.data.Sets.budget.YearStart,f.data.Sets.budget.YearEnd+1),b=R.pluck("data")(f.data.Sets.budget.DataSet),c=R.pipe(f.yearToIndex,R.nth),d=R.map(function(a){var d=f.yearToIndex(a),e=c(a),g=R.map(e)(b),h=R.sum(g),i=f.data.Sets.population.DataSet[d];return h/i})(a);return f._valueMaxCapita=R.max(d),f._valueMaxCapita},this.superFractionCompute=function(){var a=R.range(f.data.Sets.budget.YearStart,f.data.Sets.budget.YearEnd+1),b=R.pipe(f.yearToIndex,R.nth),c=R.pluck("data")(f.data.Sets.budget.DataSet),d=R.map(function(a){var d=(f.yearToIndex(a),b(a)),e=R.map(d)(c),g=R.sum(e);return g})(a);return f._superFractionsVsYear=R.map(function(c){var e=R.pipe(R.filter(function(a){return a.sp==c}),R.pluck("data"))(f.data.Sets.budget.DataSet),g=R.map(function(a){var c=f.yearToIndex(a),g=b(a),h=R.map(g)(e),i=R.sum(h);return i/d[c]})(a);return g})(f._superfunctions),f._superFractionsVsYear},this.maxvalueRawCompute=function(){var a=R.range(f.data.Sets.budget.YearStart,f.data.Sets.budget.YearEnd+1),b=R.pluck("data")(f.data.Sets.budget.DataSet),c=R.pipe(f.yearToIndex,R.nth),d=R.map(function(a){var d=(f.yearToIndex(a),c(a)),e=R.map(d)(b),g=R.sum(e);return g})(a);return f._valueMaxRaw=R.max(d),f._valueMaxRaw},this.maxvalueRealCompute=function(){var a=R.range(f.data.Sets.budget.YearStart,f.data.Sets.budget.YearEnd+1),b=R.pluck("data")(f.data.Sets.budget.DataSet),c=R.pipe(f.yearToIndex,R.nth),d=R.map(function(a){var d=f.yearToIndex(a),e=c(a),g=R.map(e)(b),h=R.sum(g),i=f.data.Sets.cpi.DataSet[d];return h/i})(a);return f._valueMaxReal=R.max(d),f._valueMaxReal},this.maxvalueRealCapitaCompute=function(){var a=R.range(f.data.Sets.budget.YearStart,f.data.Sets.budget.YearEnd+1),b=R.pluck("data")(f.data.Sets.budget.DataSet),c=R.pipe(f.yearToIndex,R.nth),d=R.map(function(a){var d=f.yearToIndex(a),e=c(a),g=R.map(e)(b),h=R.sum(g),i=f.data.Sets.cpi.DataSet[d],j=f.data.Sets.population.DataSet[d];return h/i/j})(a);return f._valueMaxRealCapita=R.max(d),f._valueMaxRealCapita},this.cpiFactor=function(a,b){void 0===b&&(b=2014),a=Math.floor(a),b=Math.floor(b);var c=f.yearToIndex(a),d=f.yearToIndex(b);return f.data.Sets.cpi.DataSet[c]/f.data.Sets.cpi.DataSet[d]},this._tooltipData=null,this.tooltipMouseOver=function(a){f._tooltipData=R.clone(a),f.tooltipUpdate(),f.hoverTooltip.classed("hidden",!1)},this.tooltipUpdate=function(a){void 0===a&&(a=f._tooltipData),f.hoverTooltip.select("#super").text(a.sp),f.hoverTooltip.select("#function").text(a.fn),f.hoverTooltip.select("#sub").text(a.fn!=a.sb?a.sb:"");var d=f.hoverTooltip.select("#value"),e=f.hoverTooltip.select("#value-right"),g=f.hoverTooltip.select("#delta"),h=f.value(a),i=Math.floor(10*f.deltaPercent(a))/10,j=i>0?"+":"";switch(i=1e14>i?i:"From Nothing",g.text(j+i+"%"),f._mode){case b.Raw:d.text("$"+c.dollarsToDollarString(h)),e.text("Nominal Dollars");break;case b.Real:d.text("$"+c.dollarsToDollarString(h)),e.text("Real 2014 Dollars");break;case b.GDP:var k=Math.floor(1e4*h)/100;d.text(k+"%"),e.text("of US GDP");break;case b.Capita:var k=Math.floor(h);d.text("$"+k+" / person"),e.text("Nominal Dollars");break;case b.RealCapita:var k=Math.floor(h);d.text("$"+k+" / person"),e.text("Real 2014 Dollars");break;default:d.text("Unknown mode")}f.tooltipMouseMove(a)},this.tooltipMouseMove=function(a){if(d3.event){var b=d3.event.x,c=d3.event.y;f.hoverTooltip.style("left",b+"px").style("top",c+"px")}},this.tooltipMouseOut=function(a){f._tooltipData=null,f.hoverTooltip.classed("hidden",!0)},this.setCyForObj=function(a,b){var c=f.deltaPercent(a);return a.cy=f.elevationScale(c),a},this.Year=this.data.Sets.budget.YearEnd,this.YearDesired=this.Year,this.maxvalueRawCompute(),this.maxvalueGDPCompute(),this.maxvalueCapitaCompute(),this.maxvalueRealCompute(),this.maxvalueRealCapitaCompute(),this.superFractionCompute(),this.d3GraphElement=d3.select("#"+this.id),this.collectHeightWidth();var g=this.areaForGraph();this.radiusRawScale=d3.scale.linear().domain([1e-6,this._valueMaxRaw]).range([0,g]),this.radiusGdpScale=d3.scale.linear().domain([1e-6,this._valueMaxGdp]).range([0,g]),this.radiusCapitaScale=d3.scale.linear().domain([1e-6,this._valueMaxCapita]).range([0,g]),this.radiusRealScale=d3.scale.linear().domain([1e-6,this._valueMaxReal]).range([0,g]),this.radiusRealCapitaScale=d3.scale.linear().domain([1e-6,this._valueMaxRealCapita]).range([0,g]),this.superFunctionsScale=d3.scale.linear().domain([0,1]).range([0,this.height-11]);var h=[-5,0,5];this.color=d3.scale.linear().domain(h).clamp(!0).range(["rgb(150,0,0)","rgb(193,193,193)","rgb(0,150,0)"]).interpolate(d3.interpolateRgb),this.superFunctionColor=d3.scale.category10(),this.elevationScale=d3.scale.linear().domain(h).clamp(!0).range([.7*this.height,.5*this.height,.3*this.height]),this.force=d3.layout.force().gravity(.2).charge(-12).friction(.12).size([this.width,this.height]),this.backdrop=this.d3GraphElement.append("svg:rect").attr("class","backdrop").attr("width",this.width).attr("height",this.height),this.force.on("tick",function(a){var b=.1*a.alpha;f.nodes.forEach(function(a){a.y+=(a.cy-a.y)*b});for(var d=d3.geom.quadtree(f.nodes),e=0,g=f.nodes.length;++e<g;)d.visit(c.collide(f.nodes[e]));f.d3GraphElement.selectAll(".dot").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})}),this.data.Sets.budget.DataSet=R.mapIndexed(c.addKeysForD3)(this.data.Sets.budget.DataSet),this.force.nodes(this.data.Sets.budget.DataSet),this.nodes=this.force.nodes();this.hoverTooltip=d3.select("#tooltip");var i=(this.d3GraphElement.append("g").attr("class","dots").selectAll(".dot").data(e.Sets.budget.DataSet,c.key).enter().append("circle").attr("class","dot").style("stroke","black").style("fill",function(a){return f.superFunctionColor(f._superfunctions.indexOf(a.sp))}).on("mouseover",this.tooltipMouseOver).on("mousemove",this.tooltipMouseMove).on("mouseout",this.tooltipMouseOut).call(this.force.drag),this.d3GraphElement.selectAll(".legend").data(this.superFunctionColor.domain().slice()).enter().append("g").attr("class","legend").attr("transform",this.legendTransform));i.append("rect").attr("class","blocks").attr("x",this.width-this.legendWidth()).attr("width",this.legendWidth()).attr("height",this.blockHeight).style("fill",this.superFunctionColor),i.append("text").attr("class","blocks-text").attr("x",this.width-this.legendWidth()-6).attr("y",this.legendTextY).attr("dy",".35em").style("text-anchor","end").text(this.legendText),d3.select(window).on("resize."+this.id,this.resize),this.resize()}return __extends(c,a),Object.defineProperty(c.prototype,"Year",{get:function(){return this._year},set:function(a){this._year=Math.min(this.data.YearEnd-1,Math.max(this.data.YearStart,a))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"YearDesired",{get:function(){return this._yearDesired},set:function(a){this._yearDesired=Math.min(this.data.YearEnd-1,Math.max(this.data.YearStart,a)),this.YearDesired!=this.Year&&this.RenderNewState()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Mode",{get:function(){return this._mode},set:function(a){this._mode=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"CpiFactorToCurrentYear",{get:function(){return this.cpiFactor(this.Year)},enumerable:!0,configurable:!0}),c.prototype.resetRanges=function(){var a=this.areaForGraph();this.radiusRawScale.range([0,a]),this.radiusGdpScale.range([0,a]),this.radiusCapitaScale.range([0,a]),this.radiusRealScale.range([0,a]),this.radiusRealCapitaScale.range([0,a]),this.superFunctionsScale.range([0,this.height-11])},c.prototype.areaForGraph=function(){var a=.8*d3.min([this.width,this.height])/2,b=c.radiusToArea(a);return b},c.prototype.legendWidth=function(){return Math.floor(.03*this.width)},c.prototype.superIndexFractionSize=function(a,b){void 0===b&&(b=this.Year);var c=this.yearToIndex(b),d=this._superFractionsVsYear[a][c];return Math.max(0,d)},c.prototype.superIndexFractionStart=function(a,b){if(void 0===b&&(b=this.Year),0>=a)return 0;if(a>this._superFractionsVsYear.length)return 1;var c=this.yearToIndex(b),d=R.reduceIndexed(function(b,d,e){return b+(a>e?d[c]:0)})(0)(this._superFractionsVsYear);return Math.max(0,d)},c.dollarsToDollarString=function(a){var b=a>1e9?Math.round(a/1e8)/10+" Billion":Math.round(a/1e5)/10+" Million";return b},c.areaToRadius=function(a){return 0>a?0:Math.sqrt(a/Math.PI)},c.radiusToArea=function(a){return Math.PI*a*a},c.endall=function(a,b){0===a.size()&&b();var c=0;a.each(function(){++c}).each("end",function(){--c||b.apply(this,arguments)})},c.key=function(a){return a.sp+"-"+a.fn+"-"+a.sb},c.pluckUniqueSuperFunctions=function(a){return R.pipe(R.pluck("sp"),R.uniq)(a)},c.pluckUniqueFunctions=function(a){return R.pipe(R.pluck("fn"),R.uniq)(a)},c.addKeysForD3=function(a,b){return a.x=3*b,a.y=3*b,a.cy=200,a.cx=0,a.radius=4,a},c.collide=function(a){var b=a.radius+16,c=a.x-b,d=a.x+b,e=a.y-b,f=a.y+b;return function(b,g,h,i,j){if(b.point&&b.point!==a){var k=a.x-b.point.x,l=a.y-b.point.y,m=Math.sqrt(k*k+l*l),n=a.radius+b.point.radius;n>m&&(m=(m-n)/m*.5,a.x-=k*=m,a.y-=l*=m,b.point.x+=k,b.point.y+=l)}return g>d||c>i||h>f||e>j}},c}(Utility.CbBase);a.Spending=c}(Graph||(Graph={}));var onReady=function(){var a,b=(document.getElementById("year-from"),document.getElementById("year-to")),c=new Graph.YearHead("graph-timeline-header"),d=document.getElementById("mode"),e=[{mode:"Nominal Dollars","enum":Graph.SpendingMode.Raw},{mode:"% of GDP","enum":Graph.SpendingMode.GDP},{mode:"Nominal Dollars Per Capita","enum":Graph.SpendingMode.Capita},{mode:"Real Dollars","enum":Graph.SpendingMode.Real},{mode:"Real Dollars Per Capita","enum":Graph.SpendingMode.RealCapita}],f=function(b){a.YearDesired=b},g="undefined"!=typeof setPath?setPath:"data",h=new Utility.DataAll(g);h.on("data",function(g){a=new Graph.Spending("graph-main",g),a.Year=g.YearEnd,a.YearDesired=g.YearEnd,c.SetRange(g.YearStart,g.YearEnd),c.on("newTarget",f),c.handleNewYear(g.YearEnd,g.YearEnd,0),a.on("renderedYear",function(a){b.textContent=a+"",c.newCurrentYear(a)}),d.onchange=function(b){var c=b.currentTarget.value,d=R.find(R.propEq("mode",c))(e);d&&(a.Mode=d["enum"],a.RenderNewState())}}),h.Initialize()};document.addEventListener("DOMContentLoaded",onReady,!1);